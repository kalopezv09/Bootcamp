<html>
    <head>

    </head>
    <body>
        <h1>Finanzas Públicas</h1>
        <br>
        <table>
            <thead>
                <th>Número</th>
               <th>Edad</th>
               <th>Nombre</th>
               <th>Profesion</th>
            </thead>
            <tbody id="cuerpo-tabla">

            </tbody>
        </table>

        <br>

        <h2>Lista de Estudiantes</h2>

    <form id="personaFormulario">
        <label>Identificación:</label>
        <input type="number" id="identificacion" required>
        
        <label>Nombre:</label>
        <input type="text" id="nombre" required>
        
        <label>Edad:</label>
        <input type="number" id="edad" required>
        <button type="submit">Agregar Persona</button>
    </form>
        <table>
            <thead>
                <th>Indice</th>
              <th>Valor</th>
               <th>Unidad</th>
               <th>Vigencia Desde</th>
               <th>Vigencia Hasta</th>
            </thead>
            <tbody id="cuerpo-tabla2">

            </tbody>
        </table>

        <br>


        <h1>Registro de personas desde la Base de datos</h1>
        <br>
        <table>
            <thead>
                <th>Indice</th>
                <th>Identificacion</th>
               <th>Nombre</th>
               <th>Edad</th>
            </thead>
            <tbody id="datosPersonasBD">

            </tbody>
        </table>

        <script>
            async function cargarPersonas() {
                try{
                   const respuesta = await fetch('http://127.0.0.1:5000/listarPersonas');
                   const datos = await respuesta.json();
                   const cuerpoTabla = document.getElementById("cuerpo-tabla");
                   cuerpoTabla.innerHTML = " ";
                   let indice = 1;
                   datos.forEach((item) => {
                     const fila = document.createElement('tr');
                     fila.innerHTML = `
                         <td>${indice}</td>
                         <td>${item.Edad}</td>
                         <td>${item.Nombre}</td>
                         <td>${item.Profesion}</td>
                     `;
                     indice= indice+1;
                     cuerpoTabla.appendChild(fila);
                   });
                }catch(error){
                    console.log("El error fue: "+error)
                }
            }


            async function cargarDatosFinancieros() {
                try{
                   const respuesta = await fetch('https://www.datos.gov.co/resource/32sa-8pi3.json?$limit=15');
                   const datos = await respuesta.json();
                   const cuerpoTabla = document.getElementById("cuerpo-tabla2");
                   cuerpoTabla.innerHTML = " ";
                   let indice = 1;
                   datos.forEach((item) => {
                     const fila = document.createElement('tr');
                     fila.innerHTML = `
                         <td>${indice}</td>
                         <td>${item.valor}</td>
                         <td>${item.unidad}</td>
                         <td>${item.vigenciadesde}</td>
                         <td>${item.vigenciahasta}</td>
                     `;
                     indice= indice+1;
                     cuerpoTabla.appendChild(fila);
                   });
                }catch(error){
                    console.log("El error fue: "+error)
                }
            }


            async function cargarPersonasDesdeBD() {
                try{
                   const respuesta = await fetch('http://127.0.0.1:5000/datosDeLaBase');
                   const datos = await respuesta.json();
                   const cuerpoTabla = document.getElementById("datosPersonasBD");
                   cuerpoTabla.innerHTML = " ";
                   let indice = 1;
                   datos.forEach((item) => {
                     const fila = document.createElement('tr');
                     fila.innerHTML = `
                         <td>${indice}</td>
                         <td>${item.identificacion}</td>
                         <td>${item.nombre}</td>
                         <td>${item.edad}</td>
                     `;
                     indice= indice+1;
                     cuerpoTabla.appendChild(fila);
                   });
                }catch(error){
                    console.log("El error fue: "+error)
                }
            }
        
        
        
        document.getElementById('personaFormulario').addEventListener('submit', 
        async function(event) {
            event.preventDefault();
    
            const persona = { persona: {
                identificacion: document.getElementById('identificacion').value,
                nombre: document.getElementById('nombre').value,
                edad: document.getElementById('edad').value
            }
                
            
            };
            
            try {
                const response = await fetch('http://127.0.0.1:5000/agregarPersonaBD', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(persona)
                });

                if (response.ok) {
                   console.log("Se agrego correctamente");
                } else {
                    alert('Error al agregar persona');
                }
            } catch (error) {
                console.error('Error al enviar datos:', error);
            }
        });

            document.addEventListener('DOMContentLoaded',cargarPersonas);
            
            document.addEventListener('DOMContentLoaded',cargarDatosFinancieros);
            document.addEventListener('DOMContentLoaded',cargarPersonasDesdeBD);
            
        </script>
    </body>
</html>